---
title: "kmax_var"
author: "Charles Zheng"
date: "September 28, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Source 

```{r}
compute_moments <- function(d, alpha, k, mc.reps = 1e4) {
  maxstat <- sapply(1:mc.reps, function(i) {
    aa <- matrix(rgamma(d * k, alpha), k, d)
    rs <- rowSums(aa)
    aa[cbind(which(rs == 0), sample(d, sum(rs == 0), replace = TRUE))] <- 1
    rs <- rowSums(aa)
    aa <- aa/rowSums(aa)
    lala <- apply(aa, 2, max)/k
    sum(lala)
  })
  c(mean(maxstat), sd(maxstat))
}
```

## k = 2

```{r}
k <- 2
compute_moments(2, 1e-5, k)
compute_moments(3, 1e-5, k)
compute_moments(4, 1e-5, k)
compute_moments(5, 1e-5, k)
```

## k = 3

```{r}
k <- 3
compute_moments(2, 1e-5, k)
compute_moments(3, 1e-5, k)
compute_moments(4, 1e-5, k)
compute_moments(5, 1e-5, k)
```


## k = 4

```{r}
k <- 4
compute_moments(2, 1e-5, k)
compute_moments(3, 1e-5, k)
compute_moments(4, 1e-5, k)
compute_moments(5, 1e-5, k)
compute_moments(6, 1e-5, k)
```

## k = 5

```{r}
k <- 5
compute_moments(2, 1e-5, k)
compute_moments(3, 1e-5, k)
compute_moments(4, 1e-5, k)
compute_moments(5, 1e-5, k)
compute_moments(6, 1e-5, k)
compute_moments(7, 1e-5, k)
compute_moments(8, 1e-5, k)
compute_moments(9, 1e-5, k)
compute_moments(10, 1e-5, k)
```

## k = 6

```{r}
k <- 6
compute_moments(2, 1e-5, k)
compute_moments(3, 1e-5, k)
compute_moments(4, 1e-5, k)
compute_moments(5, 1e-5, k)
compute_moments(6, 1e-5, k)
compute_moments(7, 1e-5, k)
compute_moments(8, 1e-5, k)
compute_moments(9, 1e-5, k)
compute_moments(10, 1e-5, k)
```

## k = 7

```{r}
k <- 7
compute_moments(6, 1e-5, k)
compute_moments(7, 1e-5, k)
compute_moments(8, 1e-5, k)
compute_moments(9, 1e-5, k)
compute_moments(10, 1e-5, k)
compute_moments(11, 1e-5, k)
compute_moments(12, 1e-5, k) #
compute_moments(13, 1e-5, k)
compute_moments(14, 1e-5, k)
compute_moments(15, 1e-5, k)
compute_moments(16, 1e-5, k)


compute_moments(17, 7e-2, k)
compute_moments(17, 3e-5, k)
compute_moments(17, 2e-5, k)
compute_moments(17, 1e-5, k)
```

## k = 8

```{r}
k <- 8
compute_moments(8, 1e-5, k)
compute_moments(9, 1e-5, k)
compute_moments(10, 1e-5, k)
compute_moments(11, 1e-5, k)
compute_moments(12, 1e-5, k)
compute_moments(13, 1e-5, k)
compute_moments(14, 1e-5, k)
compute_moments(15, 1e-5, k)
```


