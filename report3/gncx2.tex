\title{Upper and lower bounds on cdf of generalized non-central chi-squared}
\author{Charles Zheng and Yuval Benjamini}
\date{\today}

\documentclass[12pt]{article} 

% packages with special commands
\usepackage{amssymb, amsmath}
\usepackage{epsfig}
\usepackage{array}
\usepackage{ifthen}
\usepackage{color}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{csquotes}
\definecolor{grey}{rgb}{0.5,0.5,0.5}

\begin{document}
\maketitle

\newcommand{\tr}{\text{tr}}
\newcommand{\E}{\textbf{E}}
\newcommand{\diag}{\text{diag}}
\newcommand{\argmax}{\text{argmax}}
\newcommand{\Cov}{\text{Cov}}
\newcommand{\Var}{\text{Var}}
\newcommand{\argmin}{\text{argmin}}
\newcommand{\Vol}{\text{Vol}}
\newcommand{\comm}[1]{}

\section{Introduction}

Let $Z \sim N(0, I_p)$, and let $\mu \in \mathbb{R}^p$ and $\Sigma$ a
positive semidefinite matrix.  Define the generalized noncentral
chi-squared distribution with noncentrality $\mu$ and shape $\Sigma$
as the distribution of
\[
Y = (Z + \mu)^T \Sigma (Z + \mu)
\]

Let $V\Lambda V^T = \Sigma$ be the eigendecomposition of $\Sigma$,
and let $\eta = V^T \Sigma$.
Then
\[
Y \stackrel{d}{=} (Z + \eta)^T \Lambda (Z+\eta) = \sim_{i=1}^p \lambda_i W_i
\]
where $W_i \sim \chi^2_1(\eta_i^2)$.
Recall that the mgf of the noncentral chi-sqaured with one df is given by
\[
\E[e^{tW_i}] = \frac{\exp[\frac{\eta_i^2 t}{1-2t}]}{\sqrt{1-2t}}
\]
It follows that the moment-generating function of $Y$ is given by
\[
\E[e^{tY}] = \prod_{i=1}^p \E[e^{\lambda_i t W_i}] = \prod_{i=1}^p \frac{\exp[\frac{\eta_i^2 \lambda_i t}{1-2t \lambda_i}]}{\sqrt{1-2t \lambda_i}}
\]

\section{Upper bound}

We wish to bound the probability $\Pr[Y < x]$.
We have
\begin{align*}
\log \Pr[Y < x] &= \log \Pr[e^{tY} > e^{tx}]\text{ for }t < 0
\\&\leq \log\left(\frac{\E[e^{tY}]}{e^{tx}}\right)
\\&= \log(\E[e^{tY}]) - tx
\\&= \left(\frac{-1}{2} \sum_{i=1}^p \log(1 - 2t\lambda_i)\right) + \left(\sum_{i=1}^p \frac{\eta_i^2 \lambda_i t}{1 - 2t\lambda_i }\right) - tx
\end{align*}

Now consider minimizing the bound over $t$.
The derivative of the bound wrt $t$ is
\[
-x + \sum_{i=1}^p \frac{\lambda_i (1 + \eta_i)^2}{1-2\lambda_i t} + \frac{2\eta_i^2 \lambda_i^2 t}{(1-2\lambda_i t)^2}
\]
which, to a first-order approximation in $1/t$, is
\[
-\frac{p}{2t} - x
\]
Hence this implies that for small $x$, the optimal value of $t$ is approximately
\[
t^* \approx -\frac{p}{2x}.
\]

Plugging in this value of $t$ yields the bound
\[
\log \Pr[Y < x] < -\frac{1}{2}\left(\sum_{i=1}^p \log\left(1 + \frac{\lambda_i p}{x}\right)\right) + 
\frac{p}{2} \left(1 - \frac{1}{x}\sum_{i=1}^p \frac{\eta_i^2 \lambda_i}{1 + \frac{\lambda_i p}{x}}\right)
\]

\section{Lower bound}

From the previous notation, the probability is written as an integral over an ellipse $\mathcal{E}$:
\[
\Pr[Y < x] = \int_{\mathcal{E}} \phi(\nu - z) dz
\]
where
\[
\phi(\nu - z) = \left(\frac{1}{2\pi}\right)^{p/2} \exp^{-||\nu - z||^2/2}
\]
and
\[
\mathcal{E} = \{z \in \mathbb{R}^p: z^T \Lambda z < x\}.
\]

Define the height of the ellipse as
\[
h = \max_{z \in \mathcal{E}} \left(\frac{\eta}{||\eta||}\right)^T z = \sqrt{x \rho},
\]
where
\[
\rho = \frac{\eta^T \Sigma^{-1}\eta}{||\eta||^2},
\]
and let $z^*$ be the point in $\mathcal{E}$ which attains $z^T\eta = h||\eta||$,
whence
\[
z^* = \sqrt{\frac{x}{\rho}} \Sigma^{-1} \frac{\eta}{||\eta||}.
\]


Define the fractional cap with fraction $u$ by
\[
\mathcal{C}_u = \{z \in \mathcal{E}: \eta^T z < uh||\eta|| \}.
\]
Intuitively, this cap contains points $z \in \mathcal{E}$ with a large density $\phi(z - \nu)$.
The volume of the cap is given by
\[
x^{p/2}\Vol(B_1)/\sqrt{|\Lambda|} J(u)
\]
where
\[
J_p(u) = \frac{\int_{1-2u}^1 (1-x^2)^{\frac{p-1}{2}} dx}{\int_{-1}^1 (1-x^2)^{\frac{p-1}{2}} dx} = 
\frac{\Pr[\text{Beta}(\frac{1}{2}, \frac{p+1}{2}) > (1-2u)^2]}{2}\text{ for }u < \frac{1}{2}.
\]

Let us proceed to lower bound the density in $\mathcal{C}_u$.
This amounts to upper bounding the distance
\[
\max_{z \in \mathcal{C}_u} ||z - \eta||^2.
\]

Let us define
\[
m(u) = (||\eta|| - h(1-2u))^2 + \left(||\eta/||\eta|| - z^*|| + \sqrt{\frac{x}{\lambda_{min}} (1-(1-2u)^2)}\right)
\]
where $\lambda_{min} = \min_{i=1}^p \lambda_i$.
We claim that
\[
\max_{z \in \mathcal{C}_u} ||z - \eta||^2 \leq m(u).
\]

To prove the claim, for any $z \in \mathcal{C}_u$, decompose the difference into parallel and orthogonal components,
\[
\eta - z = \alpha \frac{\eta}{||\eta||} + \beta \eta^\perp
\]
where $\eta^\perp$ is orthogonal to $\eta$.
Hence
\[
||\eta - z||^2 = \alpha^2 + \beta^2.
\]
It suffices to show that
\[
\alpha \leq ||\eta|| - h(1-2u)
\]
and
\[
\beta \leq ||\eta/||\eta|| - z^*|| + \sqrt{\frac{x}{\lambda_{min}} (1-(1-2u)^2)}
\]
for every $z \in \mathcal{C}_u$.

Hence,
\[
\log\Pr[Y < x] \leq \log(\phi(\sqrt{m(u)})) + \log\text{Vol}(B_{\sqrt{x}}) - \frac{1}{2}\log|\lambda|
+ \log J_p(u)
\]


\end{document}



